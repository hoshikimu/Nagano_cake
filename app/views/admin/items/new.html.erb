<div class="row">
  <div class="col-xs-3 col-xs-offset-2">
    <h2>商品新規登録</h2>
    <% if @item_new.errors.any? %>
      <% @item_new.errors.full_messages.each do |message| %>
        <li class="text-danger"><%= message %></li>
      <% end %>
    <% end %>
  </div>
</div>
<div class="row">
  <%= form_for(@item_new, url: admin_items_path) do |f| %>
    <div class="col-xs-3 col-xs-offset-2">
      <div class="form-group">
        <label for="name">商品画像</label>
        <%= f.attachment_field :image, id:"file" %>
        <div id="result"></div>
        <script>
          $(function(){
            $('#file').change(function(){
              // $('img').remove();
              var file = $(this).prop('files')[0];
              if(!file.type.match('image.*')){
                  return;
              }
              var fileReader = new FileReader();
              fileReader.onloadend = function() {
                  $('#result').html('<img src="' + fileReader.result + '" width="300" height="200">');
              }
              fileReader.readAsDataURL(file);
            });
          });
        </script>
      </div>
    </div>
    <div class="col-xs-4">
      <div class="form-group">
        <label for="name">商品名</label>
        <%= f.text_field :name, class:"form-control" %>
      </div>
      <div class="form-group">
        <label for="introduction">商品説明</label>
        <%= f.text_area :introduction, size: "10x5", class:"form-control" %>
      </div>
      <div class="form-group">
        <label for="genre">ジャンル</label>
        <%= f.select :genre_id, @genres.map{ |genre| [genre.name, genre.id]}, {include_blank: "選択してください"}, class:"form-control" %>
      </div>
      <div class="form-group">
        <label for="price">税抜価格</label>
        <div class="form-inline">
          <%= f.text_field :price, class:"form-control" %><span> 円</span>
        </div>
      </div>
      <div class="form-group">
        <label for="is_sale_status">販売ステータス</label>
        <%= f.select :is_sale_status, [["販売中", true], ["売り切れ", false]], {},class:"form-control" %>
      </div>
      <%= f.submit "新規登録", class:"btn btn-success" %>
    </div>
  <% end %>
</div>
<script>
  $(function(){
      $("#item_price").change(function(){
          var str = $(this).val();
          str = str.replace( /[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g, function(s) {
              return String.fromCharCode(s.charCodeAt(0) - 65248);
          });
          $(this).val(str);
      }).change();
  });
</script>